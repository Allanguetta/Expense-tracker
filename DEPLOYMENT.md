# Deployment Guide

## 1) Backend (Render + Postgres)

The repo includes `render.yaml` and `backend/Dockerfile` for one-click Render Blueprint setup.

### Steps

1. Push current branch to GitHub.
2. In Render: `New` -> `Blueprint`.
3. Select this GitHub repo.
4. Render will create:
   - `expense-tracker-db` (managed Postgres)
   - `expense-tracker-backend` (web service from `backend/Dockerfile`)
5. After deploy, open:
   - `https://<your-backend>.onrender.com/health`
   - It should return `{ "status": "ok" }`.

### Notes

- On startup, the container runs `alembic upgrade head` before `uvicorn`.
- `DATABASE_URL` from Render is auto-mapped via `render.yaml`.
- `app.core.config` normalizes `postgres://` and `postgresql://` to `postgresql+psycopg://`.

## 2) Mobile (Expo EAS)

The repo includes `mobile/eas.json` and `mobile/.env.example`.

### One-time setup

1. In `mobile`:
   - `npm install`
   - `npx eas login`
   - `npx eas init`
2. Create `mobile/.env` from `mobile/.env.example` and set:
   - `EXPO_PUBLIC_API_BASE_URL=https://<your-backend>.onrender.com`

### Build commands

- Android preview build:
  - `npx eas build --platform android --profile preview`
- Android production build:
  - `npx eas build --platform android --profile production`
- iOS production build:
  - `npx eas build --platform ios --profile production`

### OTA updates (JS-only changes)

- `npx eas update --branch production --message "your update message"`

## 3) Environment Checklist

### Backend required env vars

- `DATABASE_URL` (set by Render Blueprint)
- `SECRET_KEY` (auto-generated by Render Blueprint)
- `ACCESS_TOKEN_EXPIRE_MINUTES` (default in blueprint)
- `REFRESH_TOKEN_EXPIRE_DAYS` (default in blueprint)

### Mobile required env vars

- `EXPO_PUBLIC_API_BASE_URL` (your deployed backend URL)
